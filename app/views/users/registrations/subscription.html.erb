<div class="subscription_wrapper">
  <% if user_signed_in? && current_user == @user %>
    <div class="show_page_panel">
    <ul>
      <li><%= link_to 'My Adverts', user_path(current_user) %></li>
      <li><%= link_to 'Settings', edit_user_registration_path %></li>
      <li><%= link_to 'Subscription', subscription_path %></li> 
    </ul>
    </div> 
  <% end %>

  <div id="flash">
    <% if flash[:notice] %>
      <h3><%= flash[:notice] %></h3>
    <% end %>
    <% if flash[:error] %>
      <h3><%= flash[:error] %></h3>
    <% end %> 
  </div>

  <div class="subscription_content">
    <div class="subscription_header">
      <div class="subscription_form_logo">
        <span class="icon-propeller-big"></span>
      </div>

      <% if resource.plan.name == "Free" %>
        Upgrade to Premium
      <% else %>
        Cancel Subscription
      <% end %>
    </div>

  <div class="subscription_payment">

  <% if resource.plan.name == "Free" %>

  
  <%= form_for(resource, :as => resource_name, :url => users_update_plan_path, :html => { id: 'update_plan', :method => :put }) do |f| %><!-- id: 'update_plan' refers to update_plan.js.coffee -->
    <%= devise_error_messages! %>
    <% if @user.errors.any? %>  
      <div id="errorExplanation">  
        <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>  
        <ul>  
        <% @user.errors.full_messages.each do |msg| %>  
          <li><%= msg %></li>  
        <% end %>  
        </ul>  
      </div>  
    <% end %> 

    <%= hidden_field_tag 'plan', @premium_plan.id %>
    <%= hidden_field_tag 'email', resource.email %>
    <%= f.hidden_field :stripe_card_token, id: 'new_token' %><!-- id: 'new_token' refers to update_plan.js.coffee -->

    <div class="auth_form">
      <%= f.label :coupon, "Discount number", :class => "auth_label" %>
      <%= f.text_field :coupon, :class => "auth_field" %>
    </div>
    
    <div class="form-group">
      <%= label_tag :card_number, "Credit Card Number" %>
      <%= text_field_tag :card_number, nil, name: nil, class: 'form-control' %>
    </div>
    <div class="form-group">
      <%= label_tag :card_code, "Security Code on Card (CVV)" %>
      <%= text_field_tag :card_code, nil, name: nil, class: 'form-control' %>
    </div>
    <div class="form-group">
      <%= label_tag :card_month, "Card Expiration" %>
      <%= select_month nil, {add_month_numbers: true}, {name: nil, id: "card_month"} %>
      <%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: "card_year",} %>
    </div>
    <div id="stripe_error">
      <noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>
    </div>

    <div class="form-group">
      <%= f.submit "Upgrade", class: "btn btn-lg btn-success" %>
    </div>
    <% end %>

  <% else %>

  
    <%= form_for(resource, :as => resource_name, :url => users_cancel_plan_path, :html => { id: 'cancel_plan', :method => :put }) do |f| %>

    <%= hidden_field_tag 'customer', resource.stripe_customer_token %>

    <%= f.submit "Cancel Subscription", class: "btn btn-danger" %>

    <% end %>

  <% end %>

    </div>
  </div>

  <div class="subscription_details">
    Plan Details
  </div>
</div>